== Create Custom Policies for Build-Time Checks

Prisma Cloud includes out-of-the-box policies that enable you to detect misconfigurations and provide automated fixes for security issues that are detected across your onboarded code repositories and pipelines.
You can review this list of Configuration policies of subtype Build on the Prisma Cloud administrative console.

[.task]

=== Add a New Custom Policy for Build-Time Checks

If you  have custom requirements or want to define guardrails for your specific security or compliance  needs, you have the flexibility to add custom policies. As soon as you xref:../add_devops_to_codesec.adoc[Add Your DevOps Environments to Code Security], both the out-of-the-box policies and custom  policies are used to scan for potential issues. 

[.procedure]

. Add a new custom  policy for build-time checks.

.. Select  *Policies> Add Policy> Config*
+
image::create_custompolicies.png[width=800]

.. Enter a *Policy Name.*
+
You can optionally add a *Description* to your new custom policy.  

.. Select *Policy Subtype - Build.*
+
This subtype enables you to scan IAC templates such as —Terraform, CloudFormation, Kubernetes manifest—that are used to deploy cloud resources.

.. Select the Severity.
+
You can optionally add *Labels.*

.. Click *Next*
+
In this example, you create a custom build policy for S3 Bucket ACL where log delivery is not recommended.
+
image::_2_create_custompolicies.png[width=800]

. Create the rule.
+
In a custom configuration policy rule, you can define criteria  to check the configuration for both run-time and build-time,  that is for Run and Build policy subtypes; in this example you will create a build rule only.
+
When creating a build rule for your policy, you must specify what the policy is checking for and against which resource. To do this, you specify the category type, cloud provider and resource type, and the query. After the scan, a resource that does not match the criteria you define fails the policy check and you can view the policy violation in the Code page.
+
image::_3_create_custompolicies.png[width=800]

.. Select Category Type, Cloud Provider and Resource Type.
+ 
Category type is where the policy is grouped based on either Storage, Networking. You can use the category type to search or filter specific policies. 
+
NOTE: You can create rules only for Cloud Service Providers that are supported on Prisma Cloud.
+
//TODO: Resource Type. Need to add details on this section.

.. Select Attribute, Operator and Value.
+
The query defines the match condition to verify whether a resource does not have the specified value, or if the specified value exists.
+
//TODO: You can use  And/OR logic to create a  rule with more than one query. Anagha Pamidiis there guidance on how many we allow or what is recommended?

.. Test Query to preview a list of existing resources that are not compliant with the build query you defined.
+
You can view the number of matching results and the code previews as a list in  the right pane.
+
In this example, the test results for the S3 Bucket ACL query.
+
image::_4_create_custompolicies.png[width=800]

. Add the Compliance Standards.
+
image::_5_create_custompolicies.png[width=800]

.. Select  Standard, Requirement and Sections that are important to you.

.. Click *Next*

. Add remediation to the policy. 
+
image::_6_create_custompolicies.png[width=800]
+
//TODO: You can optionally enter CLI Command and Validate to know if the specified command can be used for the new policy.

. Submit your custom policy.
+
image::_7_create_custompolicies.png[width=800]
+
After you save the custom build policy, on the next scan,  the onboarded resources are scanned against the new policy. The scan results display on the Code page where you can identify the resources that failed the check and triggered a policy violation.
